import{_ as T,c as w,o as d,w as n,b as t,a as s,f as p,Q as f,e as u,aq as h,a4 as x,d as m,a5 as c,a6 as D,a7 as k,a8 as U,a1 as y,t as r,h as P,as as E}from"./index-CkwW658k.js";import{Q as V}from"./QSpace-B9p6B1Z2.js";import{Q as A}from"./QPagination-BXXORRb3.js";import{Q as C}from"./QBadge-Cx4x6ctX.js";import{Q as q}from"./QImg-DTEDvONU.js";import{Q as I}from"./QSelect-DllAbNjc.js";import{Q}from"./QForm-ncJ53PkC.js";import{Q as S}from"./QMarkupTable-DjcI4_U-.js";import{Q as L}from"./QPage-B6yhDjV_.js";import{I as N}from"./Imprimir-yBuMVWi5.js";import"./format-CJebrXOQ.js";import"./QMenu-BxSGVo63.js";import"./_commonjsHelpers-Bx2EM-6T.js";import"./moment-C5S46NFB.js";const B={name:"VentasNew",data(){return{codigoTipoDocumentoIdentidades:[{value:1,label:"CI - CEDULA DE IDENTIDAD"},{value:2,label:"CEX - CEDULA DE IDENTIDAD DE EXTRANJERO"},{value:5,label:"NIT - NÚMERO DE IDENTIFICACIÓN TRIBUTARIA"},{value:3,label:"PAS - PASAPORTE"},{value:4,label:"OD - OTRO DOCUMENTO DE IDENTIDAD"}],loading:!1,ventaDialog:!1,efectivo:"",venta:{nit:"0",nombre:"SN",codigoTipoDocumentoIdentidad:1,tipo_venta:"Interno",tipo_pago:"Efectivo",complemento:"",email:""},pagination:{page:1,rowsPerPage:24,rowsNumber:0},receta_id:null,recognition:null,activeField:null,productos:[],productosSearch:"",productosVentas:[],loteDialog:!1,lotesLoading:!1,lotes:[],loteSelected:null,loteCantidad:1,lotePrecio:0,loteProducto:null}},computed:{totalVenta(){return this.productosVentas.reduce((i,e)=>i+Number(e.cantidad)*Number(e.precio),0)},cambio(){const e=(Number(this.efectivo)||0)-this.totalVenta;return e>0?e:0}},mounted(){if(this.$nextTick(()=>{this.$refs.inputBuscarProducto?.focus()}),this.productosGet(),"webkitSpeechRecognition"in window||"SpeechRecognition"in window){const i=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new i,this.recognition.lang="es-ES",this.recognition.interimResults=!1,this.recognition.continuous=!1,this.recognition.onresult=e=>{const g=e.results[0][0].transcript;this.activeField&&(this.venta[this.activeField]+=g)},this.recognition.onerror=e=>{console.error("Error en reconocimiento de voz:",e.error)}}},methods:{getImagenUrl(i){return`${this.$url}../images/${i}`},formatPrice(i){const e=Number(i)||0;return parseFloat(e.toFixed(2))},getDaysRemaining(i){if(!i)return"N/A";const e=new Date,v=new Date(i)-e;return Math.ceil(v/(1e3*60*60*24))+" días"},getDaysColor(i){if(!i)return"grey";const e=new Date,v=new Date(i)-e,l=Math.ceil(v/(1e3*60*60*24));return l<=0?"red":l<=30?"orange":"green"},isProductInCart(i){return this.productosVentas.some(e=>e.producto_id===i.id)},handleProductClick(i){if(i.stock<=0){this.$q.notify({type:"warning",message:"Producto sin stock disponible",timeout:2e3});return}this.openLoteDialog(i)},removeFromCart(i){this.$q.dialog({title:"Confirmar",message:"¿Eliminar producto del carrito?",cancel:!0,persistent:!0}).onOk(()=>{this.productosVentas.splice(i,1),this.$q.notify({type:"info",message:"Producto eliminado del carrito",timeout:1500})})},updateSubtotal(i){return i.cantidad<1&&(i.cantidad=1),i.precio*i.cantidad},async openLoteDialog(i){this.loteProducto=i,this.loteDialog=!0,this.lotes=[],this.lotesLoading=!0;try{const e=await this.$axios.get(`productos/${i.id}/historial-compras-ventas`);if(this.lotes=e.data||[],this.lotes.length===1){const g=this.lotes[0];this.onPickLote(g),g.disponible>0&&(this.lotePrecio=Number(i.precio)||0,this.loteCantidad=1,this.$q.dialog({title:"Lote único disponible",message:`¿Agregar automáticamente el producto al carrito?
Lote: ${g.lote||"N/A"}
Disponible: ${g.disponible}`,cancel:!0,persistent:!0,ok:{label:"Agregar",color:"primary"},cancel:{label:"Cancelar",color:"grey"}}).onOk(()=>{this.confirmarLote()}))}}catch(e){console.error(e),this.$q.notify({type:"negative",message:"No se pudieron cargar los lotes",timeout:3e3})}finally{this.lotesLoading=!1}},onPickLote(i){this.loteSelected=i,this.lotePrecio=Number(this.loteProducto?.precio)||0,this.loteCantidad=1},confirmarLote(){if(!this.loteSelected){this.$q.notify({type:"warning",message:"Selecciona un lote",timeout:2e3});return}const i=Number(this.loteSelected.disponible||0),e=Number(this.loteCantidad||0),g=Number(this.lotePrecio||0);if(e<=0){this.$q.notify({type:"negative",message:"La cantidad debe ser mayor a 0",timeout:2e3});return}if(e>i){this.$q.notify({type:"negative",message:`Cantidad excede el disponible (${i})`,timeout:3e3});return}if(g<=0){this.$q.notify({type:"negative",message:"El precio debe ser mayor a 0",timeout:2e3});return}const v=this.productosVentas.findIndex(l=>l.compra_detalle_id===this.loteSelected.id);v>=0?(this.productosVentas[v].cantidad+=e,this.$q.notify({type:"info",message:"Cantidad actualizada en el carrito",timeout:2e3})):(this.productosVentas.push({producto_id:this.loteProducto.id,cantidad:e,precio:g,producto:this.loteProducto,compra_detalle_id:this.loteSelected.id,lote:this.loteSelected.lote,fecha_vencimiento:this.loteSelected.fecha_vencimiento}),this.$q.notify({type:"positive",message:"Producto agregado al carrito",icon:"check",timeout:1500})),this.loteDialog=!1,this.loteSelected=null,this.loteProducto=null,this.loteCantidad=1,this.lotePrecio=0},searchCliente(){this.loading=!0,this.$axios.post("searchCliente",{nit:this.venta.nit}).then(i=>{this.venta.nombre="SN",this.venta.email="",this.venta.codigoTipoDocumentoIdentidad=1,i.data.nombre&&(this.venta.nombre=i.data.nombre),i.data.email&&(this.venta.email=i.data.email),i.data.codigoTipoDocumentoIdentidad&&(this.venta.codigoTipoDocumentoIdentidad=parseInt(i.data.codigoTipoDocumentoIdentidad)),i.data.complemento&&(this.venta.complemento=i.data.complemento)}).catch(i=>console.error(i)).finally(()=>this.loading=!1)},clickDialogVenta(){if(this.productosVentas.length===0){this.$q.notify({type:"warning",message:"Debe agregar al menos un producto a la venta",timeout:3e3});return}if(this.productosVentas.filter(e=>!e.precio||e.precio<=0).length>0){this.$q.notify({type:"negative",message:"Todos los productos deben tener un precio válido",timeout:3e3});return}this.ventaDialog=!0,this.efectivo=""},productosGet(){this.loading=!0,this.$axios.get("productosStock",{params:{search:this.productosSearch,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(i=>{this.productos=i.data.data,this.pagination.rowsNumber=i.data.total,this.pagination.page=i.data.current_page,this.productos.length===1&&this.productos[0].barra===this.productosSearch&&(this.openLoteDialog(this.productos[0]),this.productosSearch="")}).catch(i=>{console.error(i),this.$q.notify({type:"negative",message:"Error al cargar productos",timeout:3e3})}).finally(()=>{this.loading=!1})},submitVenta(){if(!this.venta.nit||this.venta.nit.trim()===""){this.$q.notify({type:"warning",message:"El CI/NIT es requerido",timeout:3e3});return}this.loading=!0,this.$axios.post("ventas",{ci:this.venta.nit,nombre:this.venta.nombre,email:this.venta.email,codigoTipoDocumentoIdentidad:this.venta.codigoTipoDocumentoIdentidad,complemento:this.venta.complemento,productos:this.productosVentas,tipo_venta:this.venta.tipo_venta,tipo_pago:this.venta.tipo_pago,receta_id:this.receta_id}).then(i=>{this.ventaDialog=!1,this.$q.notify({type:"positive",message:"Venta realizada con éxito",icon:"check",timeout:3e3}),i.data.tipo_comprobante==="FACTURA"?(console.log("Imprimiendo factura...",i.data),N.printFactura(i.data)):(console.log("Imprimiendo nota de venta...",i.data),N.nota(i.data)),this.productosVentas=[],this.venta={nit:"0",nombre:"SN",codigoTipoDocumentoIdentidad:1,tipo_venta:"Interno",tipo_pago:"Efectivo",complemento:"",email:""},this.receta_id=null,this.productosGet(),this.$nextTick(()=>this.$refs.inputBuscarProducto?.focus())}).catch(i=>{console.error(i);const e=i?.response?.data?.message||"No se pudo realizar la venta";this.$q.notify({type:"negative",message:e,timeout:5e3})}).finally(()=>{this.loading=!1})},calculateChange(){},startRecognition(i){this.recognition?(this.activeField=i,this.recognition.start()):this.$q.notify({type:"warning",message:"El reconocimiento de voz no está disponible",timeout:3e3})}}},R={class:"row items-center q-mb-md"},z={class:"row q-col-gutter-lg"},M={class:"col-12 col-md-7"},F={class:"row q-col-gutter-md q-mb-md"},O={class:"col-12"},G={class:"flex flex-center q-mb-sm"},X={class:"row q-col-gutter-sm"},j={class:"relative-position"},J={class:"absolute-full flex flex-center bg-grey-3 text-grey-8"},H={class:"absolute-top-right q-pa-xs"},K={class:"absolute-bottom bg-transparent"},W={class:"text-caption text-center text-weight-bold text-white text-shadow q-px-xs"},Y={class:"row items-center justify-between"},Z={class:"text-caption text-grey-7"},$={class:"text-h6 text-primary text-weight-bold"},ee={key:0,class:"col-12 text-center q-py-xl"},te={class:"col-12 col-md-5"},oe={class:"row items-center"},se={key:0,class:"row items-center q-mb-md"},ie={class:"col-6 text-right"},le={class:"text-h5 text-primary text-weight-bold"},ne={key:1,class:"cart-container"},ae={class:"scrollable-container"},re={class:"row items-center"},de={class:"col-3"},ce={class:"col-7 q-pl-sm"},ue={class:"text-caption text-weight-bold text-truncate"},me={class:"text-caption text-grey-7"},pe={class:"row items-center q-mt-xs"},ge={class:"col-6"},he={class:"col-6 text-right"},fe={class:"text-subtitle2 text-primary"},ve={class:"col-2 text-center"},be={key:2,class:"text-center q-py-xl"},_e={class:"q-mt-lg"},xe={class:"row q-col-gutter-lg"},ye={class:"col-12 col-md-4"},Ve={class:"row q-col-gutter-sm"},we={class:"col-12"},Ce={class:"col-12"},De={class:"col-12"},ke={class:"col-12"},qe={class:"col-12"},Pe={class:"col-12"},Ie={class:"col-12 col-md-8"},Se={class:"row items-center"},Ne={class:"text-h5 text-primary text-weight-bold"},Te={class:"scrollable-table"},Ue={class:"row items-center"},Ee={class:"text-caption"},Ae={class:"text-center"},Qe={class:"text-center"},Le={class:"text-center"},Be={class:"text-right"},Re={class:"text-right text-weight-bold"},ze={class:"bg-grey-2"},Me={colspan:"2",class:"text-right text-h5 text-primary text-weight-bold"},Fe={key:0},Oe={colspan:"2",class:"text-right"},Ge={key:1},Xe={colspan:"2",class:"text-right text-h5 text-green text-weight-bold"},je={class:"q-mb-md"},Je={class:"text-subtitle1 text-weight-bold"},He={class:"text-caption text-grey-7"},Ke={class:"text-center"},We={class:"text-left"},Ye={class:"text-center"},Ze={class:"text-center"},$e={class:"text-center"},et={class:"text-center"},tt={key:1,class:"text-center q-py-xl"},ot={key:2,class:"q-mt-lg"},st={class:"text-subtitle2 q-mb-sm"},it={class:"row"},lt={class:"col-12 col-md-4"},nt={class:"col-12 col-md-4 text-center"},at={class:"text-h6 text-primary text-weight-bold"},rt={class:"row q-mt-md"};function dt(i,e,g,v,l,a){return d(),w(L,{class:"q-pa-md"},{default:n(()=>[t("div",R,[s(p,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:e[0]||(e[0]=o=>i.$router.go(-1)),class:"q-mr-sm"}),e[20]||(e[20]=t("div",{class:"text-h5 text-weight-bold text-primary"},"Ventas",-1)),s(V),s(p,{flat:"",round:"",dense:"",icon:"refresh",onClick:a.productosGet,loading:l.loading},null,8,["onClick","loading"])]),t("div",z,[t("div",M,[s(f,{class:"shadow-1",flat:"",bordered:""},{default:n(()=>[s(u,{class:"bg-primary text-white"},{default:n(()=>e[21]||(e[21]=[t("div",{class:"text-h6"},"Productos Disponibles",-1),t("div",{class:"text-caption"},"Seleccione productos para la venta",-1)])),_:1}),s(u,null,{default:n(()=>[t("div",F,[t("div",O,[s(h,{ref:"inputBuscarProducto",modelValue:l.productosSearch,"onUpdate:modelValue":[e[2]||(e[2]=o=>l.productosSearch=o),a.productosGet],outlined:"",clearable:"",label:"Buscar producto por nombre o código de barras",dense:"",debounce:"300",class:"search-input"},{prepend:n(()=>[s(m,{name:"search"})]),append:n(()=>[l.recognition?(d(),w(p,{key:0,round:"",dense:"",flat:"",icon:"mic",onClick:e[1]||(e[1]=o=>a.startRecognition("productosSearch"))})):x("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"])])]),t("div",G,[s(A,{size:"sm",modelValue:l.pagination.page,"onUpdate:modelValue":[e[3]||(e[3]=o=>l.pagination.page=o),a.productosGet],max:Math.ceil(l.pagination.rowsNumber/l.pagination.rowsPerPage),color:"primary","boundary-numbers":"","max-pages":"5"},null,8,["modelValue","max","onUpdate:modelValue"])]),t("div",X,[(d(!0),c(D,null,k(l.productos,o=>(d(),c("div",{key:o.id,class:"col-6 col-md-4 col-lg-3"},[s(f,{class:U(["product-card cursor-pointer shadow-1",{"bg-blue-1":a.isProductInCart(o)}]),onClick:b=>a.handleProductClick(o)},{default:n(()=>[t("div",j,[s(q,{src:a.getImagenUrl(o.imagen),style:{height:"120px"},class:"product-image"},{error:n(()=>[t("div",J,[s(m,{name:"image",size:"32px"})])]),default:n(()=>[t("div",H,[o.stock>0?(d(),w(C,{key:0,color:"green"},{default:n(()=>[y(r(o.stock)+" disp. ",1)]),_:2},1024)):(d(),w(C,{key:1,color:"red"},{default:n(()=>e[22]||(e[22]=[y(" Sin stock ")])),_:1}))])]),_:2},1032,["src"]),t("div",K,[t("div",W,r(i.$filters.textUpper(o.nombre)),1)])]),s(u,{class:"q-pt-xs q-pb-sm"},{default:n(()=>[t("div",Y,[t("div",Z,r(o.unidad||"Unidad"),1),t("div",$,r(a.formatPrice(o.precio))+" Bs ",1)])]),_:2},1024)]),_:2},1032,["onClick","class"])]))),128)),l.productos.length===0?(d(),c("div",ee,[s(m,{name:"search_off",size:"48px",color:"grey-5"}),e[23]||(e[23]=t("div",{class:"text-h6 text-grey-6 q-mt-sm"},"No se encontraron productos",-1)),e[24]||(e[24]=t("div",{class:"text-caption text-grey-5"},"Intente con otro término de búsqueda",-1))])):x("",!0)])]),_:1})]),_:1})]),t("div",te,[s(f,{class:"shadow-1",flat:"",bordered:""},{default:n(()=>[s(u,{class:"bg-green text-white"},{default:n(()=>[t("div",oe,[e[25]||(e[25]=t("div",{class:"text-h6"},"Carrito de Venta",-1)),s(V),s(p,{round:"",dense:"",flat:"",icon:"delete",color:"white",onClick:e[4]||(e[4]=o=>{l.productosVentas=[],i.$q.notify({type:"info",message:"Carrito vaciado"})}),title:"Vaciar carrito"}),s(p,{round:"",dense:"",flat:"",icon:"shopping_cart",color:"white",class:"q-ml-xs"},{default:n(()=>[s(C,{floating:"",color:"red",rounded:""},{default:n(()=>[y(r(l.productosVentas.length),1)]),_:1})]),_:1})])]),_:1}),s(u,null,{default:n(()=>[l.productosVentas.length>0?(d(),c("div",se,[e[26]||(e[26]=t("div",{class:"col-6"},[t("div",{class:"text-subtitle1 text-weight-bold"},"Total:")],-1)),t("div",ie,[t("div",le,r(a.formatPrice(a.totalVenta))+" Bs ",1)])])):x("",!0),l.productosVentas.length>0?(d(),c("div",ne,[t("div",ae,[(d(!0),c(D,null,k(l.productosVentas,(o,b)=>(d(),c("div",{key:b,class:"cart-item q-mb-sm"},[s(f,{flat:"",bordered:""},{default:n(()=>[s(u,{class:"q-pa-sm"},{default:n(()=>[t("div",re,[t("div",de,[s(q,{src:a.getImagenUrl(o.producto?.imagen),style:{height:"60px","border-radius":"4px"},class:"item-image"},null,8,["src"])]),t("div",ce,[t("div",ue,r(i.$filters.textUpper(o.producto?.nombre)),1),t("div",me," Lote: "+r(o.lote||"N/A"),1),t("div",pe,[t("div",ge,[s(h,{modelValue:o.cantidad,"onUpdate:modelValue":[_=>o.cantidad=_,_=>a.updateSubtotal(o)],modelModifiers:{number:!0},type:"number",min:"1",dense:"",borderless:"",style:{"max-width":"70px"}},{prepend:n(()=>[s(m,{name:"numbers",size:"xs"})]),_:2},1032,["modelValue","onUpdate:modelValue"]),s(h,{modelValue:o.precio,"onUpdate:modelValue":[_=>o.precio=_,_=>a.updateSubtotal(o)],modelModifiers:{number:!0},type:"number",step:"0.01",min:"0",dense:"",borderless:"",style:{"max-width":"100px","margin-left":"8px"}},{prepend:n(()=>[s(m,{name:"attach_money",size:"xs"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),t("div",he,[t("div",fe,r(a.formatPrice(o.precio*o.cantidad))+" Bs ",1)])])]),t("div",ve,[s(p,{flat:"",round:"",dense:"",color:"red",icon:"close",size:"sm",onClick:_=>a.removeFromCart(b),title:"Eliminar"},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024)]))),128))])])):(d(),c("div",be,[s(m,{name:"shopping_cart",size:"64px",color:"grey-4"}),e[27]||(e[27]=t("div",{class:"text-h6 text-grey-6 q-mt-sm"},"Carrito vacío",-1)),e[28]||(e[28]=t("div",{class:"text-caption text-grey-5"},"Agregue productos desde el panel izquierdo",-1))])),t("div",_e,[s(p,{label:"Procesar Venta",color:"positive",icon:"point_of_sale",class:"full-width",size:"lg","no-caps":"",loading:l.loading,disable:l.productosVentas.length===0,onClick:a.clickDialogVenta},null,8,["loading","disable","onClick"])])]),_:1})]),_:1})])]),s(P,{modelValue:l.ventaDialog,"onUpdate:modelValue":e[14]||(e[14]=o=>l.ventaDialog=o),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:n(()=>[s(f,{class:"full-height"},{default:n(()=>[s(u,{class:"row items-center q-pb-none bg-primary text-white"},{default:n(()=>[e[29]||(e[29]=t("div",{class:"text-h5"},"Confirmar Venta",-1)),s(V),s(p,{flat:"",round:"",dense:"",icon:"close",onClick:e[5]||(e[5]=o=>l.ventaDialog=!1)})]),_:1}),s(u,null,{default:n(()=>[t("div",xe,[t("div",ye,[s(f,{flat:"",bordered:""},{default:n(()=>[s(u,{class:"bg-blue-grey-1"},{default:n(()=>e[30]||(e[30]=[t("div",{class:"text-h6"},"Datos del Cliente",-1)])),_:1}),s(u,null,{default:n(()=>[s(Q,null,{default:n(()=>[t("div",Ve,[t("div",we,[s(h,{modelValue:l.venta.nit,"onUpdate:modelValue":[e[6]||(e[6]=o=>l.venta.nit=o),a.searchCliente],outlined:"",dense:"",label:"CI/NIT *",debounce:500,rules:[o=>!!o||"Campo requerido"]},{prepend:n(()=>[s(m,{name:"badge"})]),_:1},8,["modelValue","onUpdate:modelValue","rules"])]),t("div",Ce,[s(h,{modelValue:l.venta.nombre,"onUpdate:modelValue":e[7]||(e[7]=o=>l.venta.nombre=o),outlined:"",dense:"",label:"Nombre *",rules:[o=>!!o||"Campo requerido"]},{prepend:n(()=>[s(m,{name:"person"})]),_:1},8,["modelValue","rules"])]),t("div",De,[s(h,{modelValue:l.venta.email,"onUpdate:modelValue":e[8]||(e[8]=o=>l.venta.email=o),outlined:"",dense:"",label:"Email",type:"email"},{prepend:n(()=>[s(m,{name:"email"})]),_:1},8,["modelValue"])]),t("div",ke,[s(I,{modelValue:l.venta.codigoTipoDocumentoIdentidad,"onUpdate:modelValue":e[9]||(e[9]=o=>l.venta.codigoTipoDocumentoIdentidad=o),outlined:"",dense:"",label:"Tipo de documento",options:l.codigoTipoDocumentoIdentidades,"emit-value":"","map-options":""},{prepend:n(()=>[s(m,{name:"description"})]),_:1},8,["modelValue","options"])]),t("div",qe,[s(h,{modelValue:l.venta.complemento,"onUpdate:modelValue":e[10]||(e[10]=o=>l.venta.complemento=o),outlined:"",dense:"",label:"Complemento"},{prepend:n(()=>[s(m,{name:"info"})]),_:1},8,["modelValue"])]),t("div",Pe,[s(I,{modelValue:l.venta.tipo_pago,"onUpdate:modelValue":e[11]||(e[11]=o=>l.venta.tipo_pago=o),outlined:"",dense:"",label:"Tipo de pago *",options:["Efectivo","QR"],rules:[o=>!!o||"Campo requerido"]},{prepend:n(()=>[s(m,{name:"payments"})]),_:1},8,["modelValue","rules"])])])]),_:1})]),_:1})]),_:1})]),t("div",Ie,[s(f,{flat:"",bordered:""},{default:n(()=>[s(u,{class:"bg-blue-grey-1"},{default:n(()=>[t("div",Se,[e[31]||(e[31]=t("div",{class:"text-h6"},"Detalles de la Venta",-1)),s(V),t("div",Ne," Total: "+r(a.formatPrice(a.totalVenta))+" Bs ",1)])]),_:1}),s(u,null,{default:n(()=>[t("div",Te,[s(S,{dense:"",flat:"",bordered:"",class:"no-shadow"},{default:n(()=>[e[35]||(e[35]=t("thead",{class:"bg-grey-3"},[t("tr",null,[t("th",{class:"text-left"},"Producto"),t("th",{class:"text-center"},"Lote"),t("th",{class:"text-center"},"Vence"),t("th",{class:"text-center"},"Cant."),t("th",{class:"text-right"},"Precio Unit."),t("th",{class:"text-right"},"Subtotal")])],-1)),t("tbody",null,[(d(!0),c(D,null,k(l.productosVentas,(o,b)=>(d(),c("tr",{key:b},[t("td",null,[t("div",Ue,[s(q,{src:a.getImagenUrl(o.producto?.imagen),style:{width:"40px",height:"40px","border-radius":"4px"},class:"q-mr-sm"},null,8,["src"]),t("div",Ee,r(i.$filters.textUpper(o.producto?.nombre||"")),1)])]),t("td",Ae,r(o.lote||"—"),1),t("td",Qe,r(o.fecha_vencimiento||"—"),1),t("td",Le,r(o.cantidad),1),t("td",Be,r(a.formatPrice(o.precio))+" Bs",1),t("td",Re,r(a.formatPrice(o.precio*o.cantidad))+" Bs ",1)]))),128))]),t("tfoot",ze,[t("tr",null,[e[32]||(e[32]=t("td",{colspan:"4",class:"text-right text-h6"},"TOTAL",-1)),t("td",Me,r(a.formatPrice(a.totalVenta))+" Bs ",1)]),l.venta.tipo_pago==="Efectivo"?(d(),c("tr",Fe,[e[33]||(e[33]=t("td",{colspan:"4",class:"text-right text-h6"},"Efectivo Recibido",-1)),t("td",Oe,[s(h,{modelValue:l.efectivo,"onUpdate:modelValue":[e[12]||(e[12]=o=>l.efectivo=o),a.calculateChange],modelModifiers:{number:!0},type:"number",step:"0.01",min:"0",dense:"",outlined:"",style:{"max-width":"150px",float:"right"}},null,8,["modelValue","onUpdate:modelValue"])])])):x("",!0),l.venta.tipo_pago==="Efectivo"?(d(),c("tr",Ge,[e[34]||(e[34]=t("td",{colspan:"4",class:"text-right text-h6"},"Cambio",-1)),t("td",Xe,r(a.formatPrice(a.cambio))+" Bs ",1)])):x("",!0)])]),_:1})])]),_:1})]),_:1})])])]),_:1}),s(E,{align:"right",class:"q-pa-md bg-grey-2"},{default:n(()=>[s(p,{label:"Cancelar",color:"grey",onClick:e[13]||(e[13]=o=>l.ventaDialog=!1),"no-caps":"",class:"q-px-lg"}),s(p,{label:"Confirmar Venta",color:"positive",icon:"check",onClick:a.submitVenta,loading:l.loading,"no-caps":"",class:"q-px-lg"},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(P,{modelValue:l.loteDialog,"onUpdate:modelValue":e[19]||(e[19]=o=>l.loteDialog=o),persistent:""},{default:n(()=>[s(f,{style:{"max-width":"800px",width:"90vw"}},{default:n(()=>[s(u,{class:"row items-center q-pb-none bg-primary text-white"},{default:n(()=>[e[36]||(e[36]=t("div",{class:"text-h6"},"Seleccionar Lote",-1)),s(V),s(p,{flat:"",round:"",dense:"",icon:"close",onClick:e[15]||(e[15]=o=>l.loteDialog=!1)})]),_:1}),s(u,null,{default:n(()=>[t("div",je,[t("div",Je," Producto: "+r(i.$filters.textUpper(l.loteProducto?.nombre||"")),1),t("div",He," Precio: "+r(a.formatPrice(l.loteProducto?.precio))+" Bs ",1)]),l.lotes.length>0?(d(),w(S,{key:0,dense:"",flat:"",bordered:"",class:"no-shadow"},{default:n(()=>[e[37]||(e[37]=t("thead",{class:"bg-grey-3"},[t("tr",null,[t("th",{class:"text-center"},"#"),t("th",{class:"text-left"},"Lote"),t("th",{class:"text-center"},"Vencimiento"),t("th",{class:"text-center"},"Días Restantes"),t("th",{class:"text-center"},"Disponible"),t("th",{class:"text-center"},"Acción")])],-1)),t("tbody",null,[(d(!0),c(D,null,k(l.lotes,(o,b)=>(d(),c("tr",{key:o.id},[t("td",Ke,r(b+1),1),t("td",We,r(o.lote||"N/A"),1),t("td",Ye,r(o.fecha_vencimiento||"—"),1),t("td",Ze,[s(C,{color:a.getDaysColor(o.fecha_vencimiento)},{default:n(()=>[y(r(a.getDaysRemaining(o.fecha_vencimiento)),1)]),_:2},1032,["color"])]),t("td",$e,[s(C,{color:o.disponible>0?"green":"red"},{default:n(()=>[y(r(o.disponible),1)]),_:2},1032,["color"])]),t("td",et,[s(p,{size:"sm",color:"primary",label:"Seleccionar","no-caps":"",onClick:_=>a.onPickLote(o),disable:o.disponible<=0},null,8,["onClick","disable"])])]))),128))])]),_:1})):(d(),c("div",tt,[s(m,{name:"inventory_2",size:"48px",color:"grey-5"}),e[38]||(e[38]=t("div",{class:"text-h6 text-grey-6 q-mt-sm"},"No hay lotes disponibles",-1))])),l.loteSelected?(d(),c("div",ot,[s(f,{flat:"",bordered:""},{default:n(()=>[s(u,null,{default:n(()=>[t("div",st,[e[39]||(e[39]=y(" Configurar cantidad y precio Lote: ")),t("b",null,r(l.loteSelected.lote),1)]),t("div",it,[t("div",lt,[s(h,{modelValue:l.loteCantidad,"onUpdate:modelValue":e[16]||(e[16]=o=>l.loteCantidad=o),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Cantidad",min:1,max:Number(l.loteSelected.disponible||0),rules:[o=>o>=1||"Mínimo 1",o=>o<=l.loteSelected.disponible||`Máximo ${l.loteSelected.disponible}`]},{prepend:n(()=>[s(m,{name:"numbers"})]),_:1},8,["modelValue","max","rules"]),s(h,{modelValue:l.lotePrecio,"onUpdate:modelValue":e[17]||(e[17]=o=>l.lotePrecio=o),modelModifiers:{number:!0},type:"number",step:"0.01",dense:"",outlined:"",label:"Precio"},{prepend:n(()=>[s(m,{name:"attach_money"})]),_:1},8,["modelValue"])]),t("div",nt,[e[40]||(e[40]=t("div",{class:"text-caption text-grey-7 q-mb-xs"},"Subtotal",-1)),t("div",at,r(a.formatPrice(l.loteCantidad*l.lotePrecio))+" Bs ",1)])]),t("div",rt,[s(V),s(p,{label:"Cancelar",color:"grey",onClick:e[18]||(e[18]=o=>l.loteDialog=!1),"no-caps":"",class:"q-mr-sm"}),s(p,{color:"primary",icon:"add_shopping_cart",label:"Agregar al carrito","no-caps":"",onClick:a.confirmarLote,loading:l.loading},null,8,["onClick","loading"])])]),_:1})]),_:1})])):x("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[41]||(e[41]=t("div",{id:"myElement",class:"hidden"},null,-1))]),_:1})}const Ct=T(B,[["render",dt],["__scopeId","data-v-cee590fb"]]);export{Ct as default};
